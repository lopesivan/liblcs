<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
	<title>
		libLCS - A Logic Circuit Simulation Library in C++
	</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>

<body>
<br>
<center>
<table>
	<tr>
		<td>
			<img src = "logo.jpg">
		</td>
		<td>
			<h1> - A Logic Circuit Simulation Library in C++</h1>
		</td>
	</tr>
</table>
</center>

<br><br>

<div class = "tabs">
<ul>
	<li><a class = "el" href = "index.html"><span>Home</span></a></li>
	<li><a class = "el" href = "news.html"><span>News</span></a></li>
	<li><a class = "el" href = "examples.html"><span>Examples</span></a></li>
	<li><a class = "el" href = "userguide.html"><span>Userguide</span></a></li>
	<li><a class = "el" href = "devguide.html"><span>Developer Guide</span></a></li>
	<li><a class = "el" href = "download.html"><span>Download</span></a></li>
	<li><a class = "el" href = "install.html"><span>Install</span></a></li>
	<li><a class = "el" href = "links.html"><span>Links</span></a></li>
	<li><a class = "el" href = "archives.html"><span>Archives</span></a></li>
</ul>
</div>

<br><br>

<!-- Generated by Doxygen 1.4.7 -->
<h1><a class="anchor" name="four_bit_counter_module">(libLCS Example) Functional module of a 4-bit counter</a></h1><hr>
<p>
The aim of this example is to implement a functional module for a positive edge triggered 4-bit counter. The block digram for the module is as shown below. It is a very simple module without a reset pin.<p>
<div align="center">
<img src="four_bit_counter_module.jpg" alt="four_bit_counter_module.jpg">
</div>
<p>
The code to implement and test the above module is as follows.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;lcs/bus.h&gt;</span>
<span class="preprocessor">#include &lt;lcs/clock.h&gt;</span>
<span class="preprocessor">#include &lt;lcs/module.h&gt;</span>
<span class="preprocessor">#include &lt;lcs/simul.h&gt;</span>
<span class="preprocessor">#include &lt;lcs/changeMonitor.h&gt;</span>

<span class="keyword">using namespace </span>lcs;
<span class="keyword">using namespace </span>std;

<span class="comment">// Let the name of our counter module be Counter.</span>
<span class="comment">// It has to be derived from the class lcs::Module.</span>
<span class="keyword">class </span>Counter : <span class="keyword">public</span> Module
{
<span class="keyword">public</span>:

    <span class="comment">// The constructor should take the output bus and the</span>
    <span class="comment">// clock input as the arguments.</span>
    Counter(<span class="keyword">const</span> Bus&lt;4&gt; &amp;outbus, <span class="keyword">const</span> InputBus&lt;&gt; &amp;clk);

    <span class="comment">// The virtual destructor.</span>
    <span class="keyword">virtual</span> ~Counter();

    <span class="comment">// Since our counter module will be triggered by the</span>
    <span class="comment">// positive edge of the clock, it has to override the</span>
    <span class="comment">// function lcs::Module::onPosEdge.</span>
    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onPosEdge(<span class="keywordtype">int</span> portId);

<span class="keyword">private</span>:
    <span class="comment">// Private members to store references to the output</span>
    <span class="comment">// bus and the clock input.</span>
    Bus&lt;4&gt; outBus;
    InputBus&lt;&gt; clock;
};

Counter::Counter(<span class="keyword">const</span> Bus&lt;4&gt; &amp;outbus, <span class="keyword">const</span> InputBus&lt;&gt; &amp;clk)
       : Module(), outBus(outbus), clock(clk)
{
    <span class="comment">// Register with the clock input to be notified of</span>
    <span class="comment">// a lcs::LINE_POS_EDGE event.</span>
    clock.notify(<span class="keyword">this</span>, LINE_POS_EDGE, 0);
        
        outBus = 0;
}

Counter::~Counter()
{
    <span class="comment">// De-register with the clock input so that it will stop</span>
    <span class="comment">// notifying line events to a non-existant module.</span>
    clock.stopNotification(<span class="keyword">this</span>, LINE_POS_EDGE, 0);
}

<span class="keywordtype">void</span> Counter::onPosEdge(<span class="keywordtype">int</span> portId)
{
    <span class="keywordtype">int</span> val = outBus.toInt();

    <span class="keywordflow">if</span> (val == 15) <span class="comment">// If the bus holds a value of fifteen, then reset the value to zero.</span>
    {
        outBus = 0;
    }
    <span class="keywordflow">else</span> <span class="comment">// If the bus holds a value other than 15, then increment it by 1.</span>
    {
        outBus = val+1;
    }
}

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    Bus&lt;4&gt; output;
    Clock clk = Clock::getClock();

    Counter counter(output, clk);

    ChangeMonitor&lt;4&gt; count(output, string(<span class="stringliteral">"Count"</span>), DUMP_ON);

    Simulation::setStopTime(4000);
    Simulation::start();

    <span class="keywordflow">return</span> 0;
}
</pre></div><p>
The output when the above program is compiled and run is as follows.<p>
<div class="fragment"><pre class="fragment">At time: 0,     Count: 0000
At time: 100,   Count: 0001
At time: 300,   Count: 0010
At time: 500,   Count: 0011
At time: 700,   Count: 0100
At time: 900,   Count: 0101
At time: 1100,  Count: 0110
At time: 1300,  Count: 0111
At time: 1500,  Count: 1000
At time: 1700,  Count: 1001
At time: 1900,  Count: 1010
At time: 2100,  Count: 1011
At time: 2300,  Count: 1100
At time: 2500,  Count: 1101
At time: 2700,  Count: 1110
At time: 2900,  Count: 1111
At time: 3100,  Count: 0000
At time: 3300,  Count: 0001
At time: 3500,  Count: 0010
At time: 3700,  Count: 0011
At time: 3900,  Count: 0100
</pre></div><p>
Below is the screenshot of the gtkwave plot of the generated VCD file.<p>
<div align="center">
<img src="screenshots/4_bit_counter_module.jpg" alt="4_bit_counter_module.jpg">
</div>
 <hr>
<center>
	Copyright &copy 2006, 2007 Siva Chandra <br>
	<img src = "logo_small.jpg">
</center>
</body>
</html>

