<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
	<title>
		libLCS - A Logic Circuit Simulation Library in C++
	</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>

<body>
<br>
<center>
<table>
	<tr>
		<td>
			<img src = "logo.jpg">
		</td>
		<td>
			<h1> - A Logic Circuit Simulation Library in C++</h1>
		</td>
	</tr>
</table>
</center>

<br><br>

<div class = "tabs">
<ul>
	<li><a class = "el" href = "index.html"><span>Home</span></a></li>
	<li><a class = "el" href = "news.html"><span>News</span></a></li>
	<li><a class = "el" href = "examples.html"><span>Examples</span></a></li>
	<li><a class = "el" href = "userguide.html"><span>Userguide</span></a></li>
	<li><a class = "el" href = "devguide.html"><span>Developer Guide</span></a></li>
	<li><a class = "el" href = "download.html"><span>Download</span></a></li>
	<li><a class = "el" href = "install.html"><span>Install</span></a></li>
	<li><a class = "el" href = "links.html"><span>Links</span></a></li>
	<li><a class = "el" href = "archives.html"><span>Archives</span></a></li>
</ul>
</div>

<br><br>

<!-- Generated by Doxygen 1.4.7 -->
<h1><a class="anchor" name="two_bit_fa_mixed_module">(libLCS Example) 2-bit fulladder module as a hybrid of behavioral and block level compenents</a></h1><hr>
<p>
The aim of this example is to illustrate defining and implementing modules which are constructed as a hybrid of other modules and behavioral models. We take a simple example wherein a 2-bit fulladder module is built using two 1-bit fulladder components. One of these 1-bit fulladder is the off-the-shelf fulladder module provided in libLCS. The other fulladder module is implemented as a behavioral model. The block diagram for such a scheme is as follows.<p>
<div align="center">
<img src="2bit_fa_module.jpg" alt="2bit_fa_module.jpg">
</div>
<br>
<p>
<br>
 The following code is the complete program which implements the above 2-bit fulladder module.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;lcs/lcs.h&gt;</span>

<span class="keyword">using namespace </span>lcs;

<span class="comment">// Since the module is going to have few behavioral constructs, we should derive </span>
<span class="comment">// it from the base class lcs::Module.</span>
<span class="keyword">class </span>TwoBitFullAdder : <span class="keyword">public</span> Module
{
<span class="keyword">public</span>:
    <span class="comment">// The constructor takes arguments which establish the external connections.</span>
    TwoBitFullAdder(<span class="keyword">const</span> Bus&lt;3&gt; &amp;sum, <span class="keyword">const</span> InputBus&lt;2&gt; &amp;a, <span class="keyword">const</span> InputBus&lt;2&gt; &amp;a);

    ~TwoBitFullAdder();

    <span class="comment">// This is a virtual function which has to be overidden. It is declared in the </span>
    <span class="comment">// base class Module. This is the function which should incorporate the behavioral</span>
    <span class="comment">// model for a one bit fulladder.</span>
    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onStateChange(<span class="keywordtype">int</span> portId);

<span class="keyword">private</span>:

    InOutBus&lt;1&gt; c1; <span class="comment">// The carry input for the fulladder with a behavioral model.</span>
    InputBus&lt;2&gt; a_, b_; <span class="comment">// The inputs to our 2-bit fulladder.</span>
    Bus&lt;3&gt; s; <span class="comment">// The sum output of our full adder.</span>
    FullAdder *fa; <span class="comment">// The fulladder module which will be created in the constructor.</span>
};

TwoBitFullAdder::TwoBitFullAdder(<span class="keyword">const</span> Bus&lt;3&gt; &amp;sum, <span class="keyword">const</span> InputBus&lt;2&gt; &amp;a, <span class="keyword">const</span> InputBus&lt;2&gt; &amp;b)
    : Module(), c1(0), a_(a), b_(b), s(sum)
{
    Bus&lt;&gt; cin(0); <span class="comment">// The carry input to the fulladder module.</span>
    fa = <span class="keyword">new</span> FullAdder(s[0], c1, a[0], b[0], cin); <span class="comment">// Initialising the fulladder module.</span>

    <span class="comment">// The 2-bit fulladder module has to respond to state changes in the relevant </span>
    <span class="comment">// input bits and the carry output of the fulladder module. Hence the module has to request </span>
    <span class="comment">// notification of line events from these signals. Note here that the carry input c1 for the </span>
    <span class="comment">// behavioral model is declared to be of type lcs::InOutBus. If it were to be declared </span>
    <span class="comment">// as a normal lcs::Bus object, then it will not be able to notify the behavioral</span>
    <span class="comment">// model about the events on its lines.</span>
    c1.notify(<span class="keyword">this</span>, LINE_STATE_CHANGE, 1);
    a_.notify(<span class="keyword">this</span>, LINE_STATE_CHANGE, 2, 1);
    b_.notify(<span class="keyword">this</span>, LINE_STATE_CHANGE, 3, 1);
}

TwoBitFullAdder::~TwoBitFullAdder()
{
    <span class="keyword">delete</span> fa;

    c1.stopNotification(<span class="keyword">this</span>, LINE_STATE_CHANGE, 1);
    a_.stopNotification(<span class="keyword">this</span>, LINE_STATE_CHANGE, 2, 1);
    b_.stopNotification(<span class="keyword">this</span>, LINE_STATE_CHANGE, 3, 1);
}

<span class="keywordtype">void</span> TwoBitFullAdder::onStateChange(<span class="keywordtype">int</span> portId)
{
    <span class="comment">// When a state change occurs on of the lines c1[0] or a_[1] or b[1],</span>
    <span class="comment">// The behavioral model should compute the bit values for the second </span>
    <span class="comment">// and third sum output bits and write them onto the output bus. </span>
    <span class="comment">// This is done as follows.</span>
    s[1] = (~a_[1] &amp; ~b_[1] &amp; c1[0]) | (~a_[1] &amp; b_[1] &amp; ~c1[0]) |
                    (a_[1] &amp; ~b_[1] &amp; ~c1[0]) | (a_[1] &amp; b_[1] &amp; c1[0]);;
    s[2] = (~a_[1] &amp; b_[1] &amp; c1[0]) | (a_[1] &amp; ~b_[1] &amp; c1[0]) |
                      (a_[1] &amp; b_[1] &amp; ~c1[0]) | (a_[1] &amp; b_[1] &amp; c1[0]);
}

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    Bus&lt;2&gt; a, b; <span class="comment">// Inputs </span>
    Bus&lt;3&gt; sum;  <span class="comment">// Sum output</span>

    <span class="comment">// Initialising a 2-bit fulladder module.</span>
    TwoBitFullAdder adder(sum, a, b);

    <span class="comment">// A tester to generate inputs for the 2-bit fulladder module.</span>
    Tester&lt;4&gt; tester((a, b)); 

    ChangeMonitor&lt;2&gt; amon(a, <span class="stringliteral">"A"</span>);
    ChangeMonitor&lt;2&gt; bmon(b, <span class="stringliteral">"B"</span>);
    ChangeMonitor&lt;3&gt; smon(sum, <span class="stringliteral">"SUM"</span>);

    Simulation::setStopTime(2000);
    Simulation::start();
        
    <span class="keywordflow">return</span> 0;
}
</pre></div><p>
The following is the output when the following is compiled and run.<p>
<div class="fragment"><pre class="fragment">At time: 0,     A: 00
At time: 0,     B: 00
At time: 0,     SUM: 000
At time: 200,   A: 01
At time: 200,   SUM: 001
At time: 300,   A: 10
At time: 300,   SUM: 010
At time: 400,   A: 11
At time: 400,   SUM: 011
At time: 500,   A: 00
At time: 500,   B: 01
At time: 500,   SUM: 001
At time: 600,   A: 01
At time: 600,   SUM: 010
At time: 700,   A: 10
At time: 700,   SUM: 011
At time: 800,   A: 11
At time: 800,   SUM: 100
At time: 900,   A: 00
At time: 900,   B: 10
At time: 900,   SUM: 010
At time: 1000,  A: 01
At time: 1000,  SUM: 011
At time: 1100,  A: 10
At time: 1100,  SUM: 100
At time: 1200,  A: 11
At time: 1200,  SUM: 101
At time: 1300,  A: 00
At time: 1300,  B: 11
At time: 1300,  SUM: 011
At time: 1400,  A: 01
At time: 1400,  SUM: 100
At time: 1500,  A: 10
At time: 1500,  SUM: 101
At time: 1600,  A: 11
At time: 1600,  SUM: 110
</pre></div> <hr>
<center>
	Copyright &copy 2006, 2007 Siva Chandra <br>
	<img src = "logo_small.jpg">
</center>
</body>
</html>

